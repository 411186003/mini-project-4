name: C Build Simple

on:
push:
branches:
- main

jobs:
build-and-test:
runs-on: ubuntu-latest

steps:
- name: Checkout repository
  uses: actions/checkout@v3

- name: Compile encoder
  run: gcc encoder.c -o encoder

- name: Compile decoder
  run: gcc decoder.c -o decoder

- name: Run encoder
  run: ./encoder input.txt codebook.csv encoded.bin encoder.log

- name: Upload encoder artifacts
  uses: actions/upload-artifact@v3
  with:
    name: encoder-artifacts
    path: |
      encoded.bin
      codebook.csv
      encoder.log

- name: Run decoder
  run: ./decoder encoded.bin codebook.csv output.txt decoder.log

- name: Upload decoder artifacts
  uses: actions/upload-artifact@v3
  with:
    name: decoder-artifacts
    path: |
      output.txt
      decoder.log

- name: Verify output
  run: diff input.txt output.txt
